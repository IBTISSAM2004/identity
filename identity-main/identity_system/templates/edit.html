<!DOCTYPE html>
<html>
<head>
    <title>Edit Identity</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow p-4">
        <h2 class="mb-4 text-center">Edit Identity</h2>

        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Error:</strong> {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        {% if person['status'] == 'Archived' %}
        <div class="alert alert-warning" role="alert">
            <strong>⚠️ Archived Record:</strong> This record is archived and cannot be edited.
        </div>
        {% endif %}

        <form method="POST" {% if person['status'] == 'Archived' %}onsubmit="return false;"{% endif %}>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">First Name</label>
                    <input type="text"
                           name="first_name"
                           class="form-control"
                           value="{{person['first_name']}}"
                           {% if person['status'] == 'Archived' %}disabled{% endif %}
                           required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Last Name</label>
                    <input type="text"
                           name="last_name"
                           class="form-control"
                           value="{{person['last_name']}}"
                           {% if person['status'] == 'Archived' %}disabled{% endif %}
                           required>
                </div>
            </div>

            <!-- additional fields -->
            <div class="mb-3">
                <label class="form-label">National ID</label>
                <input type="text" name="national_id" class="form-control" value="{{person['national_id'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>
            <div class="mb-3">
                <label class="form-label">Diploma Type</label>
                <input type="text" name="diploma_type" class="form-control" value="{{person['diploma_type'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Diploma Year</label>
                    <input type="number" name="diploma_year" class="form-control" value="{{person['diploma_year'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Entry Year</label>
                    <input type="number" name="entry_year" class="form-control" value="{{person['entry_year'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Faculty Rank</label>
                <input type="text" name="faculty_rank" class="form-control" value="{{person['faculty_rank'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>
            <div class="mb-3">
                <label class="form-label">Primary Department</label>
                <input type="text" name="primary_department" class="form-control" value="{{person['primary_department'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>
            <div class="mb-3">
                <label class="form-label">Staff Department</label>
                <input type="text" name="staff_department" class="form-control" value="{{person['staff_department'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>
            <div class="mb-3">
                <label class="form-label">Job Title</label>
                <input type="text" name="job_title" class="form-control" value="{{person['job_title'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>
            <div class="mb-3">
                <label class="form-label">Staff Entry Date</label>
                <input type="date" name="staff_entry_date" class="form-control" value="{{person['staff_entry_date'] or ''}}" {% if person['status'] == 'Archived' %}disabled{% endif %}>
            </div>

            <div class="mb-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select" id="statusSelect" {% if person['status'] == 'Archived' %}disabled{% endif %}>
                    <option value="{{ person['status'] }}" selected disabled>{{ person['status'] }} (Current)</option>
                    {% if person['status'] == 'Pending' %}
                        <option value="Active">→ Active</option>
                    {% elif person['status'] == 'Active' %}
                        <option value="Suspended">→ Suspended</option>
                        <option value="Inactive">→ Inactive</option>
                    {% elif person['status'] == 'Suspended' %}
                        <option value="Active">→ Active</option>
                        <option value="Inactive">→ Inactive</option>
                    {% elif person['status'] == 'Inactive' %}
                        <option value="Archived">→ Archived (if 5 years passed)</option>
                    {% endif %}
                </select>
                <small class="text-muted d-block mt-1">
                    {% if person['status'] == 'Inactive' and person.get('status_changed_at') %}
                        Status changed at: {{ person['status_changed_at'] }}
                    {% endif %}
                </small>
            </div>

            <button type="submit" class="btn btn-success w-100" {% if person['status'] == 'Archived' %}disabled{% endif %}>Save Changes</button>

        </form>

        <div class="text-center mt-3">
            <a href="/" class="text-decoration-none">Home</a>
        </div>
    </div>
</div>

</body>
</html>